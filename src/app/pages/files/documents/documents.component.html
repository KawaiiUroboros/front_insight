<div class="chart" (window:resize)="onResize($event)">
    <h4>Аналитика файлов</h4>
    <hr style="border: 2.5px #edf1f7 dashed;">

    <div *ngIf="screenWidth > 950" class="row" style="max-height: 70vh;">
        <div class="left" [class]="screenWidth > 1700 ? 'col-sm-6' : 'col-sm-7'" style="max-height: 50vh;">
            <h5 style="text-align: center;">Графическое представление</h5>
            <ngx-charts-bar-vertical-2d
                [scheme]="{ domain: ['rgb(4, 77, 140)', 'rgb(21, 205, 192)', 'rgb(167, 213, 245)'] }"
                [results]="filesChart"
                [barPadding]="5"
                [groupPadding]="30"
                [gradient]="true"
                [xAxis]="true"
                [yAxis]="false"
                [legend]="true"
                [legendPosition]="screenWidth > 1700 ? 'right' : 'below'"
                [showXAxisLabel]="false"
                [showYAxisLabel]="true"
                [xAxisLabel]="'разделы'"
                [legendTitle]="''"
            >
            </ngx-charts-bar-vertical-2d>
        </div>
        <div class="right" [class]="screenWidth > 1700 ? 'col-sm-6' : 'col-sm-5'">
            <nb-card style="box-shadow: none; border: none; height: 70vh; overflow-y: scroll;">
                <h5 style="text-align: center; margin-bottom: 1rem;">Статистика по папкам</h5>
                <div class="folders">
                    <nb-card class="showFolder" *ngFor="let item of files">
                        <nb-card-header>
                            <nb-icon icon="folder-outline"></nb-icon>
                            {{item.folderName}}
                        </nb-card-header>
                        <nb-card-body>
                            Файлов: {{item.amount}} ; <wbr>Размер: {{item.totalVolume}}мб
                        </nb-card-body>
                        <nb-card-footer>
                            <span class="extensions" *ngFor="let ext of item.extensions">
                                .{{ext}}
                            </span>
                        </nb-card-footer>
                    </nb-card>
                </div>
            </nb-card>
        </div>
    </div>
    
    <div *ngIf="screenWidth <= 950" class="row" style="max-height: 70vh;">
        <div class="left" class="col-sm-12" style="max-height: 50vh; margin-bottom: 1.5vh">
            <h5 style="text-align: center;">Графическое представление</h5>
            <ngx-charts-bar-vertical-2d
                [scheme]="{ domain: ['rgb(4, 77, 140)', 'rgb(21, 205, 192)', 'rgb(167, 213, 245)'] }"
                [results]="filesChart"
                [barPadding]="5"
                [groupPadding]="30"
                [gradient]="true"
                [xAxis]="true"
                [yAxis]="false"
                [legend]="true"
                [legendPosition]="screenWidth > 1700 ? 'right' : 'below'"
                [showXAxisLabel]="false"
                [showYAxisLabel]="true"
                [xAxisLabel]="'разделы'"
                [legendTitle]="''"
            >
            </ngx-charts-bar-vertical-2d>
        </div>
        <div class="right" class="col-sm-12">
            <nb-card style="box-shadow: none; border: none; height: 30vh; overflow-y: scroll;">
                <h5 style="text-align: center; margin-bottom: 1rem;">Статистика по папкам</h5>
                <div class="folders">
                    <nb-card class="showFolder" *ngFor="let item of files">
                        <nb-card-header>
                            <nb-icon icon="folder-outline"></nb-icon>
                            {{item.folderName}}
                        </nb-card-header>
                        <nb-card-body>
                            Файлов: {{item.amount}} ; <wbr>Размер: {{item.totalVolume}}мб
                        </nb-card-body>
                        <nb-card-footer>
                            <span class="extensions" *ngFor="let ext of item.extensions">
                                .{{ext}}
                            </span>
                        </nb-card-footer>
                    </nb-card>
                </div>
            </nb-card>
        </div>
    </div>

</div>

<!-- <label class="search-label" for="search">Поиск файлов</label> -->
<nb-form-field>
    <nb-icon nbPrefix icon="search-outline" pack="eva"></nb-icon>
    <input id="filesSearch" nbInput [nbFilterInput]="dataSource" class="search-input" type="text" placeholder="Поиск" />

    <div class="actions" style="float: right;">
        <nb-icon icon="person-add-outline" pack="eva"></nb-icon>
        <nb-icon icon="trash-2-outline" (click)="deleteHighlightFiles()" [options]="{ animation: { type: 'shake' } }" pack="eva"></nb-icon>
        <nb-icon icon="more-vertical-outline" pack="eva"></nb-icon>
    </div>
</nb-form-field>


<table [nbTreeGrid]="dataSource" [nbSort]="dataSource" (sort)="updateSort($event)">
    <tr nbTreeGridHeaderRow *nbTreeGridHeaderRowDef="allColumns"></tr>
    <tr nbTreeGridRow *nbTreeGridRowDef="let row; columns: allColumns"></tr>

    <ng-container [nbTreeGridColumnDef]="fileNameColumn" style="width: 50vw !important;">
        <th nbTreeGridHeaderCell [nbSortHeader]="getSortDirection(fileNameColumn)" *nbTreeGridHeaderCellDef style="width: 35vw !important;">
            <nb-checkbox status="primary" [checked]="checkBoxsetAll" (change)="checkAll($event)"></nb-checkbox>

           <span style="margin-left: 1.5rem;">{{ fileNameColumn }}</span>
        </th>
        <td nbTreeGridCell *nbTreeGridCellDef="let row" style="align-items: center;">
            <nb-checkbox status="primary" [checked]="row.data['checkbox']" (change)="setCheckedStatus(row, $event)"></nb-checkbox>

            <nb-icon class="tableIcon" [icon]="row.data['favStar'] ? 'star' : 'star-outline' " [status]="row.data['favStar'] ? 'warning' : 'basic' " (click)="setStarStatus(row, $event) "></nb-icon>
            
            <img [src]="row.data[fileNameColumn][0]" alt="Избранное" style="margin-right: 1.5rem"/> 
            
            {{ row.data[fileNameColumn][1] }}
        </td>
    </ng-container>

    <!-- Невидимая дата для сортировки -->
    <ng-container [nbTreeGridColumnDef]="dateColumn" style="width: 0px; padding: 0px !important;">
        <th nbTreeGridHeaderCell *nbTreeGridHeaderCellDef style="width: 0px; padding: 0px !important;">
            <!-- {{ dateColumn }} -->
        </th>
        <td nbTreeGridCell *nbTreeGridCellDef="let row" style="align-items: center; width: 0px; padding: 0px !important;">
            <!-- {{ row.data[dateColumn] || "-" }} -->
        </td>
    </ng-container>

    <ng-container [nbTreeGridColumnDef]="visibleDateColumn">
        <th nbTreeGridHeaderCell [nbSortHeader]="getSortDirection(visibleDateColumn)" *nbTreeGridHeaderCellDef>
            {{ visibleDateColumn }}
        </th>
        <td nbTreeGridCell *nbTreeGridCellDef="let row" style="align-items: center;">
            {{ row.data[dateColumn] || "-" }}
        </td>
    </ng-container>

    <ng-container [nbTreeGridColumnDef]="usersColumn">
        <th nbTreeGridHeaderCell *nbTreeGridHeaderCellDef>
            {{ usersColumn }}
        </th>
        <td nbTreeGridCell *nbTreeGridCellDef="let row" class="users">

            <img width="50px" height="50px" 
              onerror="
              this.error = null; 
              this.src='../../../../assets/images/person-outline.svg'
              this.style='opacity: 0.3; border-radius: 25px'"
             
             *ngFor="let user of row.data['Пользователи']"
             src="{{server.HOST + userArrCell[user].photo}}"
             alt="{{userArrCell[user].full_name}}"
              (click)="open(userArrCell[user])"
              style="border-radius: 25px; outline: none;"
             >
        </td>
    </ng-container>

    <ng-container [nbTreeGridColumnDef]="actionColumn">
        <th nbTreeGridHeaderCell *nbTreeGridHeaderCellDef style="text-align: center;">
            {{ actionColumn }}
        </th>
        <td nbTreeGridCell *nbTreeGridCellDef="let row" style="text-align: center;">
            <!-- {{ row.data[actionColumn] || "- " }} -->

            <nb-icon icon="more-horizontal-outline" pack="eva" [nbContextMenu]="items" nbContextMenuTrigger="hover" nbContextMenuTag="my-context-menu"></nb-icon>
        </td>
    </ng-container>

    <!-- <ng-container *ngFor="let column of actionColumn; let index=i ndex " [nbTreeGridColumnDef]="column "
    [showOn]="getShowOn(index) ">
    <th nbTreeGridHeaderCell [nbSortHeader]="getSortDirection(column) " *nbTreeGridHeaderCellDef>
        {{column}}
    </th>
    <td nbTreeGridCell *nbTreeGridCellDef="let row ">
        {{row.data[column] || '-'}}
    </td>
    </ng-container> -->
</table>